{
  "rules": {
    ".read": false,
    ".write": false,

    // Liste blanche des utilisateurs autorisés
    "allowedUsers": {
      "$uid": {
        ".read": "auth != null && $uid === auth.uid",
        ".write": false
      }
    },

    // Lien compte -> appareil (lecture/écriture pour l'utilisateur)
    "userDevices": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },

    // Membres de la ferme (pour la synchronisation)
    "farmMembers": {
      "$farmId": {
        "$uid": {
          ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
          ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
        }
      }
    },

    // Données de la ferme (accès restreint aux membres autorisés)
    "farms": {
      "$farmId": {
        ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
        ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
        
        // Données métier
        "parcelles": {
          "$parcelleId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "cellules": {
          "$celluleId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "chargements": {
          "$chargementId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "semis": {
          "$semisId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "varietes": {
          "$varieteId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "ventes": {
          "$venteId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "traitements": {
          "$traitementId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        },
        "produits": {
          "$produitId": {
            ".read": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true",
            ".write": "auth != null && root.child('allowedUsers').child(auth.uid).val() === true"
          }
        }
      }
    },

    // Ancienne structure users (pour compatibilité)
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}
